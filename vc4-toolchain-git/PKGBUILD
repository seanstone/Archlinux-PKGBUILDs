# Maintainer: En Shih <seanstone5923@gmail.com>
pkgname=vc4-toolchain-git
pkgver=r54.0a3ac03
pkgrel=1
pkgdesc="A port of the GNU toolchain to the Raspberry Pi's VideoCore4 processor"
arch=('x86_64')
url="https://github.com/itszor/vc4-toolchain"
license=('custom')
depends=()
makedepends=('git' 'cmake')
provides=('vc4-toolchain')
conflicts=('vc4-toolchain')
source=('git+https://github.com/itszor/vc4-toolchain.git' 'disable-cgen-maint.patch')
md5sums=('SKIP' 'SKIP')
options=(!buildflags)

pkgver() {
    cd "$srcdir/vc4-toolchain"
    echo "r$(git rev-list --count HEAD).$(git rev-parse --short HEAD)"
}

prepare() {
    cd "$srcdir/vc4-toolchain"
    git submodule init
    git submodule update
    patch -Np1 -i "$srcdir/disable-cgen-maint.patch"
}

build() {
  cd "$srcdir/vc4-toolchain"
  ./build-all.sh 2>&1 | tee build.log
}

package() {
  cd "$srcdir/vc4-toolchain"
  cp -r prefix/* $pkgdir
}
